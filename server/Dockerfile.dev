# Этот Dockerfile предназначен для локальной разработки.
# Он устанавливает ВСЕ зависимости, включая dev-пакеты.

FROM python:3.12-slim

# Устанавливаем переменные окружения, чтобы Python работал предсказуемо
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Устанавливаем системные зависимости, необходимые для сборки python-пакетов
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    build-essential \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# Копируем только папку с файлами зависимостей, чтобы Docker мог кэшировать этот слой
COPY requirements/ /app/requirements/

# Устанавливаем все зависимости, включая dev-пакеты, из файла dev.txt
# (который, в свою очередь, ссылается на local.txt и base.txt)
RUN pip install --no-cache-dir -r /app/requirements/dev.txt

# Копируем весь остальной код проекта в рабочую директорию
COPY . .

# Этот Dockerfile не создает непривилегированного пользователя и не меняет владельца,
# так как для локальной разработки это может усложнить работу с файлами,
# которые монтируются через volume. Безопасность будет настроена в продакшен-Dockerfile.